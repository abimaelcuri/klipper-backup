
[gcode_shell_command led_print_start]
command: sudo /home/abimael/gcode_shell_commands/print_start.py 2
timeout: 5
verbose: True

[gcode_shell_command led_print_end]
command: sudo /home/abimael/gcode_shell_commands/print_end.py 2
timeout: 5
verbose: True

[gcode_shell_command led_homing]
command: sudo /home/abimael/gcode_shell_commands/homing.py 2
timeout: 5
verbose: True


[gcode_macro LED_PRINT_START]
gcode:
    RUN_SHELL_COMMAND CMD=led_print_start
[gcode_macro LED_PRINT_END]
gcode:
    RUN_SHELL_COMMAND CMD=led_print_end
[gcode_macro LED_HOMING]
gcode:
    RUN_SHELL_COMMAND CMD=led_homing



[gcode_shell_command led_set]
command: sudo /home/abimael/gcode_shell_commands/led.py
timeout: 5
verbose: True

[gcode_macro SET_LED_COLOR]
gcode:
    RUN_SHELL_COMMAND CMD=led_set PARAMS="{params.R} {params.G} {params.B} {params.BRIGHTNESS}"


# ———————————————————————————————————————————————
# Macro: PROGRESS_BAR
#  • Usa printer.print_stats.progress para ler % de impressão
#  • Chama o seu progress.py com:
#      · percent (0–100)
#      · num_leds (padrão 48)
#      · brightness (padrão 100)
# ———————————————————————————————————————————————

[gcode_shell_command progress]
command: sudo /home/abimael/gcode_shell_commands/progress.py
timeout: 5
verbose: True

# [gcode_macro PROGRESS_BAR]
# gcode:
#     {% set prog = printer.print_stats.progress|default(0.0) %}
#     {% set pct = (prog * 100)|round(0) %}
#     {% set n_leds = 11 %}
#     {% set brigth = 100 %}
#     RUN_SHELL_COMMAND CMD=progress PARAMS="{pct} {n_leds} {brigth}"
    
# [gcode_macro PROGRESS_BAR]
# gcode:
#     {% set cur = printer.print_stats.info.current_layer|default(0)|int %}
#     {% set tot = printer.print_stats.info.total_layer|default(0)|int %}
#     {% set n_leds = 48 %}
#     {% set brigth = 2 %}
#     {% if tot > 0 %}
#         {% set pct = ((cur / tot) * 100)|round(0) %}
#         RUN_SHELL_COMMAND CMD=progress PARAMS="{pct} {n_leds} {brigth}"
#     {% else %}
#         # Ainda sem total de camadas, não executa o comando
#         RESPOND PREFIX="PROGRESS_BAR" MSG="Camadas não detectadas ainda (total_layer=0)"
#     {% endif %}

# [gcode_macro PROGRESS_BAR]
# gcode:
#   {% if 'CURRENT' in params and 'TOTAL' in params %}
#     {% set current_layer = params.CURRENT | default(0) | int %}
#     {% set total_layers = params.TOTAL | default(1) | int %} # Default total to 1 to avoid division by zero

#     {% set n_leds = 48 %} # Número total de LEDs ou segmentos da barra
#     {% set brigth = 3 %} # Brilho máximo (ajuste conforme sua configuração de LED)

#     # Calcula a porcentagem
#     {% set percent = 0 %} 
#     {% if total_layers > 0 %}
#         {% set percent = ((current_layer * 100) / total_layers) | round(0) | int %}
#         {% if current_layer >= total_layers %}
#             {% set percent = 100 %}
#         {% endif %}
#     {% endif %}

#     RUN_SHELL_COMMAND CMD=progress PARAMS="{percent} {n_leds} {brigth}"

#   {% endif %}


  
[gcode_macro PROGRESS]
gcode:
  {% set pct = params.PCT | default(0) | int %}
  
  {% set n_leds = 48 %} # Número total de LEDs ou segmentos da barra
  {% set brigth = 2 %} # Brilho máximo (ajuste conforme sua configuração de LED)

  RUN_SHELL_COMMAND CMD=progress PARAMS="{pct} {n_leds} {brigth}"
